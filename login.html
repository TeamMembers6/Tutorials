<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signup Page</title>
    <style>

        body {
          margin: 0;
          padding: 0;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
          background: url('Images/Bg.jpeg') no-repeat center center fixed;
          background-size: cover;
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
          position: relative; /* Added for positioning the button */
      }
      
      /* Back button styling */
      .back-button {
          position: absolute;
          top: 20px;
          left: 20px;
          background: transparent;
          border: none;
          cursor: pointer;
          font-size: 24px; /* Adjust size as needed */
          color: rgb(237, 0, 0); /* Adjust color for visibility */
          transition: color 0.3s;
      }
      
      .back-button:hover {
          color: #ccc; /* Change color on hover */
      }
      
      /* From Uiverse.io by andrew-demchenk0 */ 
      .wrapper {
          --input-focus: #2d8cf0;
          --font-color: #323232;
          --font-color-sub: #666;
          --bg-color: #dedee4;
          --bg-color-alt: #666;
          --main-color: #323232;
      }
      .switch {
          transform: translateY(-200px);
          position: relative;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          gap: 30px;
          width: 50px;
          height: 20px;
      }
      
      .card-side::before {
          position: absolute;
          content: 'Log in';
          left: -70px;
          top: 0;
          width: 100px;
          text-decoration: underline;
          color: var(--font-color);
          font-weight: 600;
      }
      
      .card-side::after {
          position: absolute;
          content: 'Sign up';
          left: 70px;
          top: 0;
          width: 100px;
          text-decoration: none;
          color: var(--font-color);
          font-weight: 600;
      }
      
      .toggle {
          opacity: 0;
          width: 0;
          height: 0;
      }
      
      .slider {
          box-sizing: border-box;
          border-radius: 25px 25px;
          border: 2px solid var(--main-color);
          box-shadow: 2px 2px var(--main-color);
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: var(--bg-colorcolor);
          transition: 0.3s;
      }
      
      .slider:before {
          box-sizing: border-box;
          position: absolute;
          content: "";
          height: 20px;
          width: 20px;
          border: 2px solid var(--main-color);
          border-radius: 25px 25px;
          left: -2px;
          bottom: 2px;
          background-color: var(--bg-color);
          box-shadow: 0 3px 0 var(--main-color);
          transition: 0.3s;
      }
      
      .toggle:checked + .slider {
          background-color: var(--input-focus);
      }
      
      .toggle:checked + .slider:before {
          transform: translateX(30px);
      }
      
      .toggle:checked ~ .card-side:before {
          text-decoration: none;
      }
      
      .toggle:checked ~ .card-side:after {
          text-decoration: underline;
      }
      
      /* card */ 
      
      .flip-card__inner {
          width: 300px;
          height: 350px;
          position: relative;
          background-color: transparent;
          perspective: 1000px;
          text-align: center;
          transition: transform 0.8s;
          transform-style: preserve-3d;
      }
      
      .toggle:checked ~ .flip-card__inner {
          transform: rotateY(180deg);
      }
      
      .toggle:checked ~ .flip-card__front {
          box-shadow: none;
      }
      
      .flip-card__front, .flip-card__back {
          padding: 20px;
          position: absolute;
          display: flex;
          flex-direction: column;
          justify-content: center;
          -webkit-backface-visibility: hidden;
          backface-visibility: hidden;
          background: transparent;
          gap: 20px;
          border-radius: 5px;
          border: 2px solid var(--main-color);
          box-shadow: 4px 4px var(--main-color);
      }
      
      .flip-card__back {
          width: 100%;
          transform: rotateY(180deg);
      }
      
      .flip-card__form {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 20px;
      }
      
      .title {
          margin: 20px 0 20px 0;
          font-size: 25px;
          font-weight: 900;
          text-align: center;
          color: var(--main-color);
      }
      
      .flip-card__input {
          width: 250px;
          height: 40px;
          border-radius: 25px 25px;
          border: 2px solid var(--main-color);
          background-color: var(--bg-color);
          box-shadow: 4px 4px var(--main-color);
          font-size: 15px;
          font-weight: 600;
          color: var(--font-color);
          padding: 5px 10px;
          outline: none;
      }
      
      .flip-card__input::placeholder {
          color: var(--font-color-sub);
          opacity: 0.8;
      }
      
      .flip-card__input:focus {
          border: 2px solid var(--input-focus);
      }
      
      .flip-card__btn:active, .button-confirm:active {
          box-shadow: 0px 0px var(--main-color);
          transform: translate(3px, 3px);
      }
      
      .flip-card__btn {
          margin: 20px 0 20px 0;
          width: 120px;
          height: 40px;
          border-radius: 25px 25px ;
          border: 2px solid var(--main-color);
          background-color: var(--bg-color);
          box-shadow: 4px 4px var(--main-color);
          font-size: 17px;
          font-weight: 600;
          color: var(--font-color);
          cursor: pointer;
      } 
          /* Add your existing CSS styles here */
          .error {
        color: red;
        font-size: 18px;
        margin-top: -10px;
        margin-bottom: 10px;
    } 
    .flip-card__input.error {
        border: 2px solid red;
    }
    .forgot-password {
        margin-top: 10px;
        font-size: 14px;
        color: #2d8cf0; /* Adjust color for visibility */
        text-decoration: none;
        transition: color 0.3s;
    }
    
    .forgot-password:hover {
        color: #0a73cc; /* Change color on hover */
    }
/* Overlay to prevent interaction */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
    z-index: 999; /* On top of other elements, below the spinner */
    visibility: hidden; /* Hidden by default */
}

/* Spinner styles */
.spinner {
    visibility: hidden; /* Initially hidden */
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #007bff;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 0.8s linear infinite;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000; /* On top of the overlay */
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

  </style>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    <div class="spinner" id="spinner"></div>
    

  <button class="back-button" onclick="history.back();">&#8592; Back</button>
  <div class="wrapper">
      <div class="card-switch">
          <label class="switch">
              <input type="checkbox" class="toggle">
              <span class="slider"></span>
              <span class="card-side"></span>
              <div class="flip-card__inner">
                  <div class="flip-card__front">
                      <div class="title">Log in</div>
                      <form class="flip-card__form" id="loginForm">
                        <input class="flip-card__input" id="loginEmail" name="email" placeholder="Email" type="email">
                        <span class="emailError error"></span> <!-- Add this line -->
                        <input class="flip-card__input" id="loginPassword" name="password" placeholder="Password" type="password">
                        <span class="passwordError error"></span> 
                        <button class="flip-card__btn">Let's go!</button>
                        <a href="forgot-password.html" class="forgot-password">Forgot Password?</a>
                    </form>
                    
                  </div>
                  <div class="flip-card__back">
                      <div class="title">Sign up</div>
                      <form class="flip-card__form" id="signupForm">
                          <input class="flip-card__input" id="signupName" placeholder="Name" type="text" required>
                          <span class="nameError error"></span>
                          <input class="flip-card__input" id="signupEmail" name="email" placeholder="Email" type="email" required>
                          <span class="semailError error"></span>
                          <input class="flip-card__input" id="signupPassword" name="password" placeholder="Password" type="password" required>
                          <span class="spasswordError error"></span>
                          <button class="flip-card__btn signupBtn" type="submit">Confirm!</button>
                      </form>
                  </div>
              </div>
          </label>
      </div>   
  </div>
  <script>
    function isValidEmail(email) {
        const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return regex.test(email);
    }

    document.getElementById('signupForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const email = document.getElementById('signupEmail').value;
        const username = document.getElementById('signupName').value;
        const pass = document.getElementById('signupPassword').value;
    
        // Clear previous error messages
        document.querySelector('.nameError').textContent = '';
        document.querySelector('.semailError').textContent = '';
        document.querySelector('.spasswordError').textContent = '';
    
        let valid = true;
    
        // Validate name
        if (username.length < 3) {
            document.querySelector('.nameError').textContent = 'Name must be at least 3 characters.';
            valid = false;
        }
    
        // Validate email
        if (!isValidEmail(email)) {
            document.querySelector('.semailError').textContent = 'Enter a valid email.';
            valid = false;
        }
    
        // Validate password
        if (pass.length < 8) {
            document.querySelector('.spasswordError').textContent = 'Password must be at least 8 characters.';
            valid = false;
        }
    
        if (valid) {
            document.getElementById('spinner').style.visibility = 'visible'; // Show spinner
            document.getElementById('overlay').style.visibility = 'visible'; // Show overlay
            document.querySelector('.signupBtn').disabled = true; // Disable button
    
            fetch('http://localhost:5000/send-otp', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email: email, username: username, password: pass }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = `emailotp.html?email=${email}&name=${username}&pass=${pass}`;
                } else {
                    alert('Error sending OTP. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while sending the OTP.');
            })
            .finally(() => {
                document.getElementById('spinner').style.visibility = 'hidden'; // Hide spinner
                document.getElementById('overlay').style.visibility = 'hidden'; // Hide overlay
                document.querySelector('.signupBtn').disabled = false; // Re-enable button
            });
        }
    });
    
    
    // Login form handler
    document.getElementById('loginForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        // Clear previous error messages
        document.querySelector('.emailError').textContent = '';
        document.querySelector('.passwordError').textContent = '';

        let valid = true;

        // Validate email
        if (!isValidEmail(email)) {
            document.querySelector('.emailError').textContent = 'Enter a valid email.';
            valid = false;
        }

        // Validate password
        if (password.length < 8) {
            document.querySelector('.passwordError').textContent = 'Password must be at least 8 characters.';
            valid = false;
        }

        if (valid) {
            fetch('http://localhost:5000/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email: email, password: password }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                  localStorage.setItem("token",data.token);
                  localStorage.setItem("isEmail",data.email);
                  console.log(data);
                  alert('Login successful!,',data.email);
                  if (data.isadmin){
                      window.location.href='index(1).html' //admin page
                  }
                  else{
                      window.location.href='index.html' //user page
                  }
                } else {
                    if (data.message === 'User not found') {
                        document.querySelector('.emailError').textContent = 'Enter a valid email';
                    } else {
                        document.querySelector('.passwordError').textContent = 'Enter a valid password';
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred during login.');
            });
        }
    });
</script>
</body>
</html>
 